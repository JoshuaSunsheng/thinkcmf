<tc_include file="Public:hp:head"/>
<!DOCTYPE html>
<!-- saved from url=(0048) -->
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <title>医生账号</title>
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="{$CSS_URL}planeui.css"/>
    <link href="{$CSS_URL}bootstrap.css" rel="stylesheet">
    <!--<link href="tehuigou/css/style.css" rel="stylesheet">-->
    <!--<link rel="stylesheet" href="tehuigou/assets/css/app.css">-->
    <link href="{$CSS_URL}mbase.css" rel="stylesheet">
    <link rel="alternate icon" type="image/png" href="assets/i/favicon.png">
    <link rel="stylesheet" href="{$CSS_URL}amazeui.min.css">

    <style>
        html, body {
            background-color: #F0F3FA;
        }

        .col-xs-4 {
            padding-left: 0;
            padding-right: 0;
        }

        .btn {
            padding: 26px 12px;
        }

        .col-xs-6 {
            padding-left: 0;
            padding-right: 0;
        }

        .sms {
            position: absolute;
            top: 13px;
            left: 32%
        }

        .first {
            margin: auto;
            height: 420px;
        }

        .am-intro-hd {
            position: relative;
            height: 60px;
            line-height: 60px;
        }

        .am-page .am-list > li > a {
            margin-bottom: 0;
            padding-left: 10px;
        }

        .m-widget-list .widget-icon {
            width: 36px;
            height: 36px;
            margin-right: 10px;
        }

        .m-widget-list a::after {
            display: inline-block;
            font: normal normal normal 1.6rem/1 FontAwesome, sans-serif;
            font-size: inherit;
            text-rendering: auto;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transform: translate(0, 0);
            content: "\f054";
            position: absolute;
            right: 10px;
            color: #ccc;
            top: 50%;
            margin-top: -8px;
        }

    </style>

</head>
<body>
<!-- 导航	-->

<!-- Bootstrap 公众账号首页已经引入bootstrap.css-->
<!-- 新 Bootstrap 核心 CSS 文件 -->
<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
<script src="//cdn.bootcss.com/jquery/1.11.3/jquery.min.js"></script>

<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->


<script>
    var jQueryf = jQuery.noConflict();
    //mootools中嵌入jQuery 需要启动jQuery无冲突模式
</script>

<div id="preloader">
    <div class="pui-loading pui-loading-double-circle-rotation loder_status">
        <span></span>
        <span></span>
    </div>
</div>
<!-- Fixed navbar -->
<div class="row margin0">
    <!-- center-->

    <div id="doctorAccount" data-am-widget="intro" class="am-intro am-cf am-intro-default am-page">

        <div class="am-intro-hd" style="height: 60px;line-height: 60px;">
            <h2 class="am-intro-title" style="padding-left:15px"><img width="34px"
                                                                      src="{$IMG_URL}organization_icon.png"> | <span>医生账号</span>
            </h2>
        </div>
        <br>

        <ul class="am-list m-widget-list"
            style="transition-timing-function: cubic-bezier(0.1, 0.57, 0.1, 1); transition-duration: 0ms; transform: translate(0px, 0px) translateZ(0px);">
            <li style="line-height: 128px; height: 128px;">
                <a style="height: 100%; line-height: 100%;" href="javascript:displayDoctorInfo()" data-rel="figure">
                    <img style="width:100px;height: 100px; line-height: 100%;" class="widget-icon"
                         src="{$data.headlogofile}"
                         alt="Figure">
                    <span class="widget-name">医生姓名: {$data.realname} </span>
                    <span class="widget-name">积分: {$data.score} </span>
                </a></li>
        </ul>

        <div>
            <ul class="am-list m-widget-list"
                style="transition-timing-function: cubic-bezier(0.1, 0.57, 0.1, 1); transition-duration: 0ms; transform: translate(0px, 0px) translateZ(0px);">
                <li>
                    <a href="javascript:displayScoreItem();" data-rel="accordion"><img class="widget-icon"
                                                          src="http://cdn.amazeui.org/src/2.2/widget/accordion/src/accordion.png"
                                                          alt="Accordion"> <span class="widget-name">积分规则</span>
                    </a>
                </li>
                <li><a href="javascript:displayScoreList();" data-rel="accordion"><img class="widget-icon"
                                                          src="http://cdn.amazeui.org/src/2.2/widget/accordion/src/accordion.png"
                                                          alt="Accordion"> <span class="widget-name">积分统计</span></a>
                </li>

                <li><a href="javascript:displayBindCard();" data-rel="footer"><img class="widget-icon"
                                                       src="http://cdn.amazeui.org/src/2.2/widget/footer/src/footer.png"
                                                       alt="Footer"> <span
                        class="widget-name">银行卡绑定</span></a></li>
                <li style="display: none">
                    <a href="#" data-rel="divider"><img class="widget-icon"
                                                        src="http://cdn.amazeui.org/src/2.2/widget/divider/src/divider.png"
                                                        alt="Divider"> <span
                        class="widget-name">个人设置</span></a></li>

            </ul>
        </div>

        <div id="qrcode" style="width: 200px;margin:0 auto; "></div>

        <div class="clearfix"></div>

    </div>


    <div id="doctorInfo" data-am-widget="intro" class="am-intro am-cf am-intro-default am-page" style="display: none">

        <div class="am-intro-hd" style="height: 60px;line-height: 60px;">
            <h2 class="am-intro-title" style="padding-left:15px"><img width="34px"
                                                                      src="{$IMG_URL}organization_icon.png"> | <span>医生信息</span>
            </h2>
        </div>
        <br>

        <div class="am-g">
            <div class="am-u-lg-6 am-u-md-8 am-u-sm-centered">

                <form method="post" id="register" name="register" class="am-form am-form-horizontal">
                    <fieldset>
                        <input name="id" value="{$data.id}" hidden>

                        <div class="am-form-group" style="display: none;">
                            <div class="am-u-lg-12">
                                <div class="am-input-group">
                                    <span class="am-input-group-label" style="border-top-left-radius: 9px;border-bottom-left-radius: 9px;"><i class="am-icon-phone am-icon-fw"></i></span>
                                    <input type="text" class="am-form-field" id="phoneNumber" name="phoneNumber" maxlength="11" value="{$phoneNumber}" placeholder="手机号" >
                                </div>
                            </div>
                        </div>

                        <div class="am-form-group">
                            <div class="am-u-lg-12">
                                <div class="am-input-group">
                                    <span class="am-input-group-label" style="border-top-left-radius: 9px;border-bottom-left-radius: 9px;"><i class="am-icon-user am-icon-fw"></i></span>
                                    <input type="text" class="am-form-field" id="realName" name="realName" value="{$data.realname}" placeholder="输入您的姓名">
                                </div>
                            </div>
                        </div>

                        <div class="am-form-group">
                            <label class="am-u-sm-3 am-form-label">性别</label>

                            <div class="am-u-sm-7">
                                <label class="am-radio-inline">
                                    <eq name="data[sex]" value="0">
                                        <input type="radio" name="sex" value="0" checked> 男
                                        <else/>
                                        <input type="radio" name="sex" value="0"> 男
                                    </eq>
                                    <i class="am-icon-male am-icon-fw"></i>
                                </label>
                                <label class="am-radio-inline">
                                    <eq name="data[sex]" value="1">
                                        <input type="radio" name="sex" value="1" checked> 女
                                        <else/>
                                        <input type="radio" name="sex" value="1"> 女
                                    </eq>
                                    <i class="am-icon-female am-icon-fw"></i>
                                </label>
                            </div>
                            <div class="am-u-sm-5">

                            </div>
                        </div>

                        <div class="am-form-group">
                            <label for="birthday" class="am-u-sm-4 am-form-label">出生日期:</label>
                            <div class="am-u-sm-8">
                                <input id="birthday" name="birthday" type="text" class="am-form-field" placeholder="yyyy-mm-dd" data-am-datepicker required value="{$data.birthday}" readonly/>
                            </div>

                        </div>

                        <div class="am-form-group">
                            <label for="province" class="am-u-sm-12 am-form-label">所在医院:</label>
                            <div id="address">
                                <div class="am-u-sm-4">
                                    <select class="prov" id="province" name="province"></select><span class="am-form-caret"></span>
                                </div>
                                <div class="am-u-sm-4">
                                    <select class="city" id="city" name="city" disabled="disabled"></select><span class="am-form-caret"></span>
                                </div>
                                <div class="am-u-sm-4">
                                    <select class="dist" id="district" name="district" disabled="disabled"></select><span class="am-form-caret"></span>
                                </div>

                            </div>
                            <div class="am-u-sm-12" style="padding-top: 5px;">
                                <input type="text" id="hospital" name="hospital" class="am-form-field" placeholder="请输入医院名称" value="{$data.hospital}">
                            </div>
                        </div>

                        <div class="am-form-group">
                            <label for="title" class="am-u-sm-3 am-form-label">职称</label>
                            <div class="am-u-sm-6">
                                <select id="title" name="title">
                                    <option value="">请选择</option>
                                    <option value="主任医师">主任医师</option>
                                    <option value="副主任医师">副主任医师</option>
                                    <option value="主治医师">主治医师</option>
                                    <option value="住院医师">住院医师</option>
                                </select>
                                <span class="am-form-caret"></span>
                            </div>
                            <div class="am-u-sm-6">
                            </div>
                        </div>

                        <div class="am-form-group">
                            <label for="mail" class="am-u-sm-3 am-form-label">邮箱:</label>
                            <div class="am-u-sm-9">
                                <input type="text" class="" id="mail" name="mail" placeholder="请输入邮箱" value="{$data.mail}">
                            </div>
                        </div>

                        <div class="am-form-group">
                            <div class="am-u-sm-12">
                                <label for="description">个人简介</label>
                            </div>
                            <div class="am-u-sm-12">
                                <textarea class="" rows="5" id="description" name="description">{$data.description}</textarea>
                            </div>
                        </div>

                        <div class="am-form-group am-form-file">
                            <div class="am-u-sm-12">
                                <label for="description">头像照片</label>
                            </div>
                            <div class="am-form-group am-form-file am-u-sm-12">
                                <!--<button type="button" class="am-btn am-btn-default am-btn-sm">-->
                                <!--<i class="am-icon-cloud-upload"></i> 选择要上传的文件-->
                                <!--</button>-->
                                <div class="con4">
                                    <canvas id="headLogoFileCvs" width="200" height="200"></canvas>
                                <span class="btn upload">上传头像照片
                                    <input type="file" class="upload_pic" id="headLogoFile" accept="image/*" capture/>
                                </span>
                                </div>
                            </div>
                            <!--<div id="file-list"></div>-->
                        </div>

                        <div class="am-form-group">
                            <label class="am-u-sm-4 am-form-label">门诊日期:</label>
                            <div class="am-u-sm-8">
                                <label class="am-checkbox-inline" style="    margin-left: 10px;">
                                    <input type="checkbox" name="cureTime[]" value="0"> 周一上午
                                </label>
                                <label class="am-checkbox-inline">
                                    <input type="checkbox" name="cureTime[]" value="1"> 周一下午
                                </label>
                                <label class="am-checkbox-inline">
                                    <input type="checkbox" name="cureTime[]" value="2"> 周二上午
                                </label>
                                <label class="am-checkbox-inline">
                                    <input type="checkbox" name="cureTime[]" value="3"> 周二下午
                                </label>
                                <label class="am-checkbox-inline">
                                    <input type="checkbox" name="cureTime[]" value="4"> 周三上午
                                </label>
                                <label class="am-checkbox-inline">
                                    <input type="checkbox" name="cureTime[]" value="5"> 周三下午
                                </label>
                                <label class="am-checkbox-inline">
                                    <input type="checkbox" name="cureTime[]" value="6"> 周四上午
                                </label>
                                <label class="am-checkbox-inline">
                                    <input type="checkbox" name="cureTime[]" value="7"> 周四下午
                                </label>
                                <label class="am-checkbox-inline">
                                    <input type="checkbox" name="cureTime[]" value="8"> 周五上午
                                </label>
                                <label class="am-checkbox-inline">
                                    <input type="checkbox" name="cureTime[]" value="9"> 周五下午
                                </label>
                            </div>
                        </div>

                        <div class="am-form-group">
                            <label for="mail" class="am-u-sm-8 am-form-label">医生每日就诊可接受患者人数:</label>
                            <div class="am-u-sm-3" style="padding-left: 0px;padding-right: 0px;">
                                <input type="number" class="" id="maxPatient" name="maxPatient" placeholder="人数" pattern="[0-9]*" value="{$data.maxpatient}">
                            </div>
                            <label class="am-u-sm-1 am-form-label"></label>
                        </div>

                        <input type="text" class="upload_pic" name="headLogoFile" hidden/>


                        <div class="am-g">
                            <div class="am-u-sm-6 am-u-sm-centered">
                                <input type="" name="" value="修改" class="am-btn am-btn-primary am-btn-sm am-fl"
                                       onclick="reg(); return false;"
                                       style="width: 100%;">

                            </div>
                        </div>
                    </fieldset>
                </form>
                <hr>
            </div>
        </div>

    </div>

    <div id="scoreItem" data-am-widget="intro" class="am-intro am-cf am-intro-default am-page" style="display: none">

        <div class="am-intro-hd" style="height: 60px;line-height: 60px;">
            <h2 class="am-intro-title" style="padding-left:15px"><img width="34px"
                                                                      src="{$IMG_URL}organization_icon.png"> | <span>积分规则</span>
            </h2>
        </div>
        <br>

        <div id="tablelist">
            <table class="am-table am-table-bordered am-table-radius am-table-striped ">
                <thead>
                <tr>
                    <th>项目名称</th>
                    <th width="70">积分</th>
                </tr>
                </thead>
                <tbody>

                <volist name="score" id="scoreItem">
                    <tr>
                        <td>{$scoreItem.title}</td>
                        <td>{$scoreItem.value}</td>
                    </tr>
                </volist>

                </tbody>
            </table>
        </div>
    </div>

    <div id="scoreList" data-am-widget="intro" class="am-intro am-cf am-intro-default am-page" style="display: none">

        <div class="am-intro-hd" style="height: 60px;line-height: 60px;">
            <h2 class="am-intro-title" style="padding-left:15px">
                <img width="34px" src="{$IMG_URL}organization_icon.png"> | <span>积分明细</span>
            </h2>
        </div>
        <br>

        <div id="scoreDetail">
            <table class="am-table am-table-bordered am-table-radius am-table-striped ">
                <thead>
                <tr>
                    <th>项目名称</th>
                    <th>积分</th>
                    <th>时间</th>
                </tr>
                </thead>
                <tbody>

                <volist name="scoreList" id="score">
                    <tr>
                        <td>{$score.title}</td>
                        <td style="color: yellowgreen">+{$score.value}</td>
                        <td>{$score.recordtime}</td>
                    </tr>
                </volist>

                </tbody>
            </table>
        </div>
    </div>

    <div id="cardInfo" data-am-widget="intro" class="am-intro am-cf am-intro-default am-page" style="display: none">

        <div class="am-intro-hd" style="height: 60px;line-height: 60px;">
            <h2 class="am-intro-title" style="padding-left:15px">
                <img width="34px" src="{$IMG_URL}organization_icon.png"> | <span>银行卡信息</span>
            </h2>
        </div>
        <br>

        <div id="cardDetail">
            <div class="am-g">
                <div class="am-u-lg-6 am-u-md-8 am-u-sm-centered">

                    <form method="post" id="cardForm" name="cardForm" class="am-form am-form-horizontal">
                        <fieldset>
                            <input name="id" value="{$bankCard.id}" hidden>
                            <input name="doctorId" value="{$data.id}" hidden>

                            <div class="am-form-group">
                                <label class="am-u-sm-3 am-form-label">卡号:</label>

                                <div class="am-u-sm-9">
                                    <div class="am-input-group">
                                        <input type="text" class="am-form-field"  name="cardAsn" value="{$bankCard.cardasn}" placeholder="银行卡号" >
                                    </div>
                                </div>
                            </div>

                            <div class="am-form-group">
                                <label class="am-u-sm-3 am-form-label">开户名:</label>

                                <div class="am-u-sm-9">
                                    <div class="am-input-group">
                                        <input type="text" class="am-form-field" name="realName" value="{$bankCard.realname}" placeholder="银行卡开户名">
                                    </div>
                                </div>
                            </div>

                            <div class="am-form-group">
                                <label for="bankName" class="am-u-sm-3 am-form-label">银行列表</label>
                                <div class="am-u-sm-6">
                                    <select id="bankName" name="bankName">
                                        <option value="中国工商银行">中国工商银行</option>
                                        <option value="中国农业银行">中国农业银行</option>
                                        <option value="中国银行">中国银行</option>
                                        <option value="中国建设银行">中国建设银行</option>
                                        <option value="交通银行">交通银行</option>
                                        <option value="中信银行">中信银行</option>
                                        <option value="中国光大银行">中国光大银行</option>
                                        <option value="华夏银行">华夏银行</option>
                                        <option value="中国民生银行">中国民生银行</option>
                                        <option value="招商银行">招商银行</option>
                                        <option value="兴业银行">兴业银行</option>
                                        <option value="广发银行">广发银行</option>
                                        <option value="平安银行">平安银行</option>
                                        <option value="上海浦东发展银行">上海浦东发展银行</option>
                                        <option value="恒丰银行">恒丰银行</option>
                                        <option value="浙商银行">浙商银行</option>
                                        <option value="渤海银行">渤海银行</option>
                                        <option value="中国邮政储蓄银行">中国邮政储蓄银行</option>
                                    </select>
                                    <span class="am-form-caret"></span>
                                </div>
                                <div class="am-u-sm-6">
                                </div>
                            </div>

                            <div class="am-form-group">
                                <label for="province" class="am-u-sm-3 am-form-label">开户地:</label>
                                <div id="bankAddress">
                                    <div class="am-u-sm-4">
                                        <select class="prov" id="bankprovince" name="province"></select><span class="am-form-caret"></span>
                                    </div>
                                    <div class="am-u-sm-4">
                                        <select class="city" id="bankcity" name="city" disabled="disabled"></select><span class="am-form-caret"></span>
                                    </div>
                                    <div class="am-u-sm-4" style="display: none">
                                        <select class="dist" name="district" disabled="disabled"></select><span class="am-form-caret"></span>
                                    </div>

                                </div>

                            </div>

                            <div class="am-form-group">
                                <label class="am-u-sm-3 am-form-label">支行:</label>

                                <div class="am-u-sm-9">
                                    <div class="am-input-group">
                                        <input type="text" class="am-form-field"  name="subbranch" value="{$bankCard.subbranch}" placeholder="开户支行">
                                    </div>
                                </div>
                            </div>

                            <div class="am-g">
                                <div class="am-u-sm-6 am-u-sm-centered">
                                    <input type="" name="" value="修改" class="am-btn am-btn-primary am-btn-sm am-fl"
                                           onclick="bankcard(); return false;"
                                           style="width: 100%;">

                                </div>
                            </div>
                        </fieldset>
                    </form>
                    <hr>
                </div>
            </div>
        </div>
    </div>
</div>


<!--[if (gte IE 9)|!(IE)]><!-->
<script src="{$JS_URL}jquery.min.js"></script>
<!--<![endif]-->
<!--[if lte IE 8 ]>
<script src="http://libs.baidu.com/jquery/1.11.3/jquery.min.js"></script>
<script src="http://cdn.staticfile.org/modernizr/2.8.3/modernizr.js"></script>
<script src="{$JS_URL}amazeui.ie8polyfill.min.js"></script>
<![endif]-->
<script src="{$JS_URL}amazeui.min.js"></script>

<!-- center -->
<!-- JavaScript-->
<script>
    citySelect_url="{$SITE_URL}";
    //显示加载数据
    function ShowDiv() {
        $("#loading").show();
    }

    //隐藏加载数据
    function HiddenDiv() {
        $("#loading").hide();
    }
    ShowDiv();


    jQuery(".am-intro-hd").on("click", function(){
        window.location.reload(true);
    })
    function displayDoctorInfo(){
        $("#doctorAccount").hide()
        $("#doctorInfo").show()
    }

    function displayScoreItem(){
        $("#doctorAccount").hide()
        $("#scoreItem").show()
    }

    function displayScoreList(){
        $("#doctorAccount").hide()
        $("#scoreList").show()
    }

    function displayBindCard(){
        $("#doctorAccount").hide()
        $("#cardInfo").show()
    }

</script>
<script type="text/javascript" src="{$JS_URL}jquery.cityselect.js"></script>
<script src="{$JS_URL}amazeui.datetimepicker.js"></script>
<script src="{$JS_URL}jquery.qrcode.js"></script>
<script src="{$JS_URL}utf.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("#qrcode").qrcode({
            render : "canvas",    //设置渲染方式，有table和canvas，使用canvas方式渲染性能相对来说比较好
            text : "http://{$_SERVER['HTTP_HOST']}{$_SERVER['REQUEST_URI']}" + '?doctorId={$data.id}',    //扫描二维码后显示的内容,可以直接填一个网址，扫描二维码后自动跳向该链接
            width : "200",               //二维码的宽度
            height : "200",              //二维码的高度
            background : "#ffffff",       //二维码的后景色
            foreground : "#000000",        //二维码的前景色
//            src: '/Public/Uploads/Doctor/2017-02-15/58a456caae0fc.jpg'             //二维码中间的图片
            src: '{$data.headlogofile}'             //二维码中间的图片
        });
    });
</script>
<script type="text/javascript">
    $(function () {
        $("#address").citySelect({
            nodata: "none",
            required: false
        });

        $("#bankAddress").citySelect({
            nodata: "none",
            required: false
        });

    });
    $('#datetimepicker')
            .datetimepicker()
            .on('changeDate', function (ev) {
                alert(ev.date)
            });

    //医生信息修改
    function reg() {
        var tourl = $("#register").attr("action");
        var application = $("#register").serialize();

        $.post("__URL__/updateDoctor", application,function(data,textStatus){
            if(data.state == "fail"){
                alert(data.info)
            }
            else{
                location.reload();
            }
        });
    }

    function bankcard() {

        var application = $("#cardForm").serialize();

        $.post("__URL__/updateCard", application,function(data,textStatus){
            if(data.state == "fail"){
                alert(data.info)
            }
            else{
                location.reload();
            }
        });
    }

    jQuery(window).load(function () { // makes sure the whole site is loaded
        jQuery("#status").fadeOut(); // will first fade out the loading animation
        jQuery("#preloader").delay(350).fadeOut("slow"); // will fade out the white DIV that covers the website.

        //select中默认index 第一个是1, 和value刚好差1
        toSelect("title", parseInt("{$data[title]}"));

        $('input:radio[name="sex"]:checked').click();

        var curetime = "{$data[curetime]}".split(",");
        if(curetime != ""){  //当空字符串也会
            for( var br in curetime){
                $("input[name='cureTime[]']").eq(curetime[br]).attr("checked","true");
            }
        }

        function toSelect(selectId, index){
            //默认第一个是请选择, 因此需要加1
            index = index  +1;
            if(index){
                document.getElementById(selectId)[index].selected = true;
            }
        }

        //省份和城市 区
        setTimeout(function(){
            if('{$data[province]}'){
//                $("#province option:contains('{$data[cureime]}')").attr("selected", true)
                if('{$data[province]}'){
                    $("#province").val('{$data[province]}')
                }
                if('{$data[city]}'){
                    $("#city").append("<option value='{$data[city]}'>{$data[city]}</option>");
                }
                if('{$data[district]}'){
                    $("#district").append("<option value='{$data[district]}'>{$data[district]}</option>");
                }
            }

            if('{$bankCard[province]}'){
                jQuery("#bankprovince").val('{$bankCard[province]}')
            }

            if('{$bankCard[city]}'){
                jQuery("#bankcity").append("<option value='{$data[district]}'>{$bankCard[city]}</option>");
            }
        },10);
    })


    function Jumppage(page){

        var url = '__SELF__';

        $("<div></div>").load(url,{},function(){

            var data = $(this).find("#tablelist").html();
            $('#tablelist').html(data);

            $(this).remove();
        });
    }

    //上次文件
    //获取上传按钮
    var input0 = document.getElementById("headLogoFile");
    if(typeof FileReader==='undefined'){
        //result.innerHTML = "抱歉，你的浏览器不支持 FileReader";
        input0.setAttribute('disabled','disabled');
//        input1.setAttribute('disabled','disabled');
    }else{
        input0.addEventListener('change',readFile,false);
//        input1.addEventListener('change',readFile,false);
        /*input1.addEventListener('change',function (e){
         console.log(this.files);//上传的文件列表
         },false); */
    }
    function readFile(){
        var file = this.files[0];//获取上传文件列表中第一个文件
        var id = this.id;
        if(!/image\/\w+/.test(file.type)){
            //图片文件的type值为image/png或image/jpg
            alert("文件必须为图片！");
            return false;
        }
        // console.log(file);
        var reader = new FileReader();//实例一个文件对象
        reader.readAsDataURL(file);//把上传的文件转换成url
        //当文件读取成功便可以调取上传的接口
        reader.onload = function(e){
//             console.log(this.result);//文件路径
//             console.log(e.target.result);//文件路径
            var data = e.target.result.split(',');
            var tp = (file.type == 'image/png')? 'png': 'jpg';
//             var imgUrl = data[1];//图片的url，去掉(data:image/png;base64,)
            uploadPic(id,file);
            //需要上传到服务器的在这里可以进行ajax请求
            // console.log(imgUrl);
            // 创建一个 Image 对象
            /*     var image = new Image();
             // 创建一个 Image 对象
             // image.src = imgUrl;
             image.src = e.target.result;
             image.onload = function(){
             document.body.appendChild(image);
             }
             */
            var image = new Image();
            // 设置src属性
            image.src = e.target.result;
            var max=200;
            // 绑定load事件处理器，加载完成后执行，避免同步问题
            image.onload = function(){
                // 获取 canvas DOM 对象
                var canvas = document.getElementById(id + "Cvs");
                // 如果高度超标 宽度等比例缩放 *=
                /*if(image.height > max) {
                 image.width *= max / image.height;
                 image.height = max;
                 } */
                // 获取 canvas的 2d 环境对象,
                var ctx = canvas.getContext("2d");
                // canvas清屏
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                // 重置canvas宽高
                /*canvas.width = image.width;
                 canvas.height = image.height;
                 if (canvas.width>max) {canvas.width = max;}*/
                // 将图像绘制到canvas上
                // ctx.drawImage(image, 0, 0, image.width, image.height);
                ctx.drawImage(image, 0, 0, 200, 200);
                // 注意，此时image没有加入到dom之中
            };
        }
    };

    var xhr = function(){
        if (window.XMLHttpRequest) {
            return new XMLHttpRequest();
        }else{
            return new ActiveObject('Micrsorf.XMLHttp');
        }
    }();
    console.log(xhr.readyState);

    function uploadPic(id, data){
        lockScreen();
        var formdata = new FormData();
        formdata.append("photoFile", data);
//        alert(data)

        xhr.onreadystatechange = function(){
            switch(xhr.readyState){
                case 0 :
                    console.log(0,'未初始化....');
                    break;
                case 1 :
                    console.log(1,'请求参数已准备，尚未发送请求...');
                    break;
                case 2 :
                    console.log(2,'正在添加....');
                    break;
                case 3 :
                    console.log(3,'已接收数据长度：'+xhr.responseText.length );
                    break;
                case 4 :
                    console.log(4,'响应全部接受完毕');
                    if ((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304) {
                        var ret = JSON.parse(xhr.response)

                        if(location.href.indexOf('thinkcmf') > 0){ //未部署在根目录
                            $("input[name='" + id + "']").val("/thinkcmf/Public" + ret.savepath + ret.savename);
                        }
                        else{
                            $("input[name='" + id + "']").val("/Public" + ret.savepath + ret.savename);
                        }
                    }else{
                        alert('error: 上传失败, 请重试!') ;
                    }
                    setTimeout('cancelScreen()',500);

                    break;
            }
        }
        xhr.open('post','__URL__/upload');
//        xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded')
        xhr.send(formdata);

    };

</script>
</body>
</html>
