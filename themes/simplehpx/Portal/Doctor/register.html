<tc_include file="Public:hp:head" />


<style>
        .header {
            text-align: center;
        }

        .header h1 {
            font-size: 200%;
            color: #333;
            margin-top: 30px;
        }

        .header p {
            font-size: 14px;
        }


        html, body {
            background-color: #EBEBEB;
        }

        .am-form input[type=number]::-webkit-input-placeholder, .am-form input[type=search]::-webkit-input-placeholder, .am-form input[type=text]::-webkit-input-placeholder, .am-form input[type=password]::-webkit-input-placeholder, .am-form input[type=datetime]::-webkit-input-placeholder, .am-form input[type=datetime-local]::-webkit-input-placeholder, .am-form input[type=date]::-webkit-input-placeholder, .am-form input[type=month]::-webkit-input-placeholder, .am-form input[type=time]::-webkit-input-placeholder, .am-form input[type=week]::-webkit-input-placeholder, .am-form input[type=email]::-webkit-input-placeholder, .am-form input[type=url]::-webkit-input-placeholder, .am-form input[type=tel]::-webkit-input-placeholder, .am-form input[type=color]::-webkit-input-placeholder, .am-form select::-webkit-input-placeholder, .am-form textarea::-webkit-input-placeholder, .am-form-field::-webkit-input-placeholder {
             color: #BCE1F6;
         }

        .am-form input[type=number]:focus, .am-form input[type=search]:focus, .am-form input[type=text]:focus, .am-form input[type=password]:focus, .am-form input[type=datetime]:focus, .am-form input[type=datetime-local]:focus, .am-form input[type=date]:focus, .am-form input[type=month]:focus, .am-form input[type=time]:focus, .am-form input[type=week]:focus, .am-form input[type=email]:focus, .am-form input[type=url]:focus, .am-form input[type=tel]:focus, .am-form input[type=color]:focus, .am-form select:focus, .am-form textarea:focus, .am-form-field:focus {
            /*background-color: #4CB0E6;*/
            border-color: #3bb4f2;
            outline: 0;
            -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075), 0 0 5px rgba(59, 180, 242, .3);
            box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075), 0 0 5px rgba(59, 180, 242, .3)
        }

        #birthday.am-bluecolor, #address.am-bluecolor {
            background-color: #4CB0E6;
            color: #BCE1F6;
        }

        .am-form input[type=number], .am-form input[type=search], .am-form input[type=text], .am-form input[type=password], .am-form input[type=datetime], .am-form input[type=datetime-local], .am-form input[type=date], .am-form input[type=month], .am-form input[type=time], .am-form input[type=week], .am-form input[type=email], .am-form input[type=url], .am-form input[type=tel], .am-form input[type=color], .am-form select, .am-form textarea, .am-form-field {
            /*background-color: #4CB0E6;*/
            /*border-color: #3bb4f2;*/
            /*color: #BCE1F6;*/
            border-radius: 9px;
        }

        #birthday, #cureDate{
            color: #555;
        }

    </style>
<style type="text/css">
    .con4{
        width: 300px;
        height: auto;
        overflow: hidden;
        /*margin: 20px auto;*/
        color: #FFFFFF;
    }
    .con4 .btn{
        width: 100%;
        height: 40px;
        line-height: 40px;
        text-align: center;
        background: #d8b49c;
        display: block;
        font-size: 16px;
        border-radius: 5px;
    }
    .upload{
        float: left;
        position: relative;
    }
    .upload_pic{
        display: block;
        width: 100%;
        height: 40px;
        position: absolute;
        left: 0;
        top: 0;
        opacity: 0;
        border-radius: 5px;
    }
    #idnoFileCvs, #docFileCvs, #headLogoFileCvs{
        border: 1px solid #000;
        margin:20px 0 20px 50px;
    }

    .am-form-group {
        margin-bottom: 0.9rem;
    }
</style>

<link rel="stylesheet" href="{$CSS_URL}css-loader.css">

</head>
<body style="font-size: 14px;">


<div style="margin: 0;">
    <!-- Fixed navbar -->
    <div class="row margin0">
        <!-- center-->
        <div data-am-widget="intro" class="am-intro am-cf am-intro-default">
            <div class="am-intro-hd" style="height: 60px;line-height: 60px;">
                <h2 class="am-intro-title" style="padding-left:15px">
                    <img width="34px" src="{$IMG_URL}organization_icon.png"> |
                    <span>医生注册</span>
                </h2>
            </div>
        </div>

    </div>
    <br>

    <div class="am-g">
        <div class="am-u-lg-6 am-u-md-8 am-u-sm-centered">
            <form method="post" id="register" name="register" class="am-form am-form-horizontal">
                <fieldset>

                    <div class="am-form-group" style="display: none;">
                        <div class="am-u-lg-12">
                            <div class="am-input-group">
                                <span class="am-input-group-label" style="border-top-left-radius: 9px;border-bottom-left-radius: 9px;"><i class="am-icon-phone am-icon-fw"></i></span>
                                <input type="text" class="am-form-field" id="phoneNumber" name="phoneNumber" maxlength="11" value="{$phoneNumber}" placeholder="手机号" >
                            </div>
                        </div>
                    </div>

                    <div class="am-form-group">
                        <div class="am-u-lg-12">
                            <div class="am-input-group">
                                <span class="am-input-group-label" style="border-top-left-radius: 9px;border-bottom-left-radius: 9px;"><i class="am-icon-user am-icon-fw"></i></span>
                                <input type="text" class="am-form-field" id="realName" name="realName" placeholder="输入您的姓名">
                            </div>
                        </div>
                    </div>

                    <div class="am-form-group">
                        <label class="am-u-sm-3 am-form-label">性别</label>

                        <div class="am-u-sm-7">
                            <label class="am-radio-inline">
                                <input type="radio" name="sex" checked="true" value="0"> 男
                                <i class="am-icon-male am-icon-fw"></i>
                            </label>
                            <label class="am-radio-inline">
                                <input type="radio" name="sex" value="1"> 女
                                <i class="am-icon-female am-icon-fw"></i>
                            </label>
                        </div>
                        <div class="am-u-sm-5">

                        </div>
                    </div>

                    <div class="am-form-group">
                        <label for="birthday" class="am-u-sm-4 am-form-label">出生日期:</label>
                        <div class="am-u-sm-8">
                            <input id="birthday" name="birthday" type="text" class="am-form-field" placeholder="yyyy-mm-dd" data-am-datepicker required  readonly/>
                        </div>

                    </div>

                    <div class="am-form-group">
                        <label for="province" class="am-u-sm-12 am-form-label">所在医院:</label>
                        <div id="address">
                            <div class="am-u-sm-4">
                                <select class="prov" id="province" name="province"></select><span class="am-form-caret"></span>
                            </div>
                            <div class="am-u-sm-4">
                                <select class="city" id="city" name="city" disabled="disabled"></select><span class="am-form-caret"></span>
                            </div>
                            <div class="am-u-sm-4">
                                <select class="dist" id="district" name="district" disabled="disabled"></select><span class="am-form-caret"></span>
                            </div>

                        </div>
                        <div class="am-u-sm-12" style="padding-top: 5px;">
                            <input type="text" id="hospital" name="hospital" class="am-form-field" placeholder="请输入医院名称">
                        </div>
                    </div>

                    <div class="am-form-group">
                        <label for="title" class="am-u-sm-3 am-form-label">职称</label>
                        <div class="am-u-sm-6">
                            <select id="title" name="title">
                                <option value="">请选择</option>
                                <option value="主任医师">主任医师</option>
                                <option value="副主任医师">副主任医师</option>
                                <option value="主治医师">主治医师</option>
                                <option value="住院医师">住院医师</option>
                            </select>
                            <span class="am-form-caret"></span>
                        </div>
                        <div class="am-u-sm-6">
                        </div>
                    </div>

                    <div class="am-form-group">
                        <label for="mail" class="am-u-sm-3 am-form-label">邮箱:</label>
                        <div class="am-u-sm-9">
                            <input type="text" class="" id="mail" name="mail" placeholder="请输入邮箱">
                        </div>


                    </div>

                    <div class="am-form-group">
                        <div class="am-u-sm-12">
                            <label for="description">个人简介</label>
                        </div>
                        <div class="am-u-sm-12">
                            <textarea class="" rows="5" id="description" name="description"></textarea>
                        </div>
                    </div>

                    <div class="am-form-group am-form-file">
                        <div class="am-u-sm-12">
                            <label for="description">头像照片</label>
                        </div>
                        <div class="am-form-group am-form-file am-u-sm-12">
                            <!--<button type="button" class="am-btn am-btn-default am-btn-sm">-->
                            <!--<i class="am-icon-cloud-upload"></i> 选择要上传的文件-->
                            <!--</button>-->
                            <div class="con4">
                                <canvas id="headLogoFileCvs" width="200" height="200"></canvas>
                                <span class="btn upload">上传头像照片
                                    <input type="file" class="upload_pic" id="headLogoFile" accept="image/*"/>
                                </span>
                            </div>
                        </div>
                        <!--<div id="file-list"></div>-->
                    </div>

                    <div class="am-form-group am-form-file" style="display: none">
                        <div class="am-u-sm-12">
                            <label for="description">身份证照片</label>
                        </div>
                        <div class="am-form-group am-form-file am-u-sm-12">
                            <!--<button type="button" class="am-btn am-btn-default am-btn-sm">-->
                                <!--<i class="am-icon-cloud-upload"></i> 选择要上传的文件-->
                            <!--</button>-->
                            <div class="con4">
                                <canvas id="idnoFileCvs" width="200" height="200"></canvas>
                                <span class="btn upload">上传身份证照片
                                    <input type="file" class="upload_pic" id="idnoFile" accept="image/*" capture/>
                                </span>
                            </div>
                        </div>
                        <!--<div id="file-list"></div>-->
                    </div>

                    <div class="am-form-group am-form-file">
                        <div class="am-u-sm-12">
                            <label for="description">医生资格证或医院工作证</label>
                        </div>
                        <div class="am-form-group am-form-file am-u-sm-12">
                            <div class="con4">
                                <canvas id="docFileCvs" width="200" height="200"></canvas>
                                <span class="btn upload">上传医生资格证或医院工作证
                                    <input type="file" class="upload_pic" id="docFile" accept="image/*" capture/>
                                </span>
                            </div>
                        </div>
                        <!--<div id="file-list"></div>-->
                    </div>


                    <div class="am-form-group">
                        <label class="am-u-sm-4 am-form-label">门诊日期:</label>
                        <div class="am-u-sm-8">
                                <label class="am-checkbox-inline" style="    margin-left: 10px;">
                                    <input type="checkbox" name="cureTime[]" value="0" checked> 周一上午
                                </label>
                                <label class="am-checkbox-inline">
                                    <input type="checkbox" name="cureTime[]" value="1"> 周一下午
                                </label>
                                <label class="am-checkbox-inline">
                                    <input type="checkbox" name="cureTime[]" value="2"> 周二上午
                                </label>
                                <label class="am-checkbox-inline">
                                    <input type="checkbox" name="cureTime[]" value="3"> 周二下午
                                </label>
                                <label class="am-checkbox-inline">
                                    <input type="checkbox" name="cureTime[]" value="4"> 周三上午
                                </label>
                                <label class="am-checkbox-inline">
                                    <input type="checkbox" name="cureTime[]" value="5"> 周三下午
                                </label>
                                <label class="am-checkbox-inline">
                                    <input type="checkbox" name="cureTime[]" value="6"> 周四上午
                                </label>
                                <label class="am-checkbox-inline">
                                    <input type="checkbox" name="cureTime[]" value="7"> 周四下午
                                </label>
                                <label class="am-checkbox-inline">
                                    <input type="checkbox" name="cureTime[]" value="8"> 周五上午
                                </label>
                                <label class="am-checkbox-inline">
                                    <input type="checkbox" name="cureTime[]" value="9"> 周五下午
                                </label>
                        </div>
                    </div>

                    <div class="am-form-group">
                        <label for="mail" class="am-u-sm-8 am-form-label">医生每日就诊可接受患者人数:</label>
                        <div class="am-u-sm-3" style="padding-left: 0px;padding-right: 0px;">
                            <input type="number" class="" id="maxPatient" name="maxPatient" placeholder="人数" pattern="[0-9]*">
                        </div>
                        <label class="am-u-sm-1 am-form-label"></label>
                    </div>

                    <input type="text" class="upload_pic" name="headLogoFile" hidden/>
                    <!--<input type="text" class="upload_pic" name="idnoFile" hidden/>-->
                    <input type="text" class="upload_pic" name="docFile" hidden/>

                    <div class="am-g">
                        <div class="am-u-sm-6 am-u-sm-centered">
                            <input id="apply1" type="" name="" value="申请审核" class="am-btn am-btn-primary am-btn-sm am-fl"
                                   onclick="reg(); return false;"
                                   style="width: 100%;">
                            <button id="apply2" class="am-btn am-btn-primary am-btn-sm am-fl" style="width: 100%;display: none" disabled="disabled">
                                <i class="am-icon-spinner am-icon-spin"></i>
                                申请中
                            </button>
                        </div>
                    </div>
                </fieldset>
            </form>
            <hr>
        </div>
    </div>

</div>


<!-- Loader -->
<div class="loader loader-bar is-active" data-text style="display: none"></div>

<script type="text/javascript" src="{$JS_URL}jquery.min.js"></script>
<script src="{$JS_URL}amazeui.min.js"></script>
<!--<script src="{$JS_URL}lrz/lrz.bundle.js"></script>-->
<!--<script src="{$JS_URL}fileinput.js"></script>-->
<script>
    citySelect_url="{$SITE_URL}";
    //显示加载数据
    function ShowDiv() {
        $("#loading").show();
    }

    //隐藏加载数据
    function HiddenDiv() {
        $("#loading").hide();
    }

    ShowDiv();
</script>
<script type="text/javascript" src="{$JS_URL}jquery.cityselect.js"></script>
<script type="text/javascript">
    //获取上传按钮
    var input0 = document.getElementById("headLogoFile");
//    var input1 = document.getElementById("idnoFile");
    var input2 = document.getElementById("docFile");

    if(typeof FileReader==='undefined'){
        //result.innerHTML = "抱歉，你的浏览器不支持 FileReader";
        input0.setAttribute('disabled','disabled');
//        input1.setAttribute('disabled','disabled');
        input2.setAttribute('disabled','disabled');
    }else{
        input0.addEventListener('change',readFile,false);
//        input1.addEventListener('change',readFile,false);
        input2.addEventListener('change',readFile,false);
        /*input1.addEventListener('change',function (e){
         console.log(this.files);//上传的文件列表
         },false); */
    }
    function readFile(){
        var file = this.files[0];//获取上传文件列表中第一个文件
        var id = this.id;
        if(!/image\/\w+/.test(file.type)){
            //图片文件的type值为image/png或image/jpg
            alert("文件必须为图片！");
            return false;
        }
        // console.log(file);
        var reader = new FileReader();//实例一个文件对象
        reader.readAsDataURL(file);//把上传的文件转换成url
        //当文件读取成功便可以调取上传的接口
        reader.onload = function(e){
//             console.log(this.result);//文件路径
//             console.log(e.target.result);//文件路径
            var data = e.target.result.split(',');
             var tp = (file.type == 'image/png')? 'png': 'jpg';
//             var imgUrl = data[1];//图片的url，去掉(data:image/png;base64,)
            uploadPic(id,file);
            //需要上传到服务器的在这里可以进行ajax请求
             // console.log(imgUrl);
             // 创建一个 Image 对象
        /*     var image = new Image();
             // 创建一个 Image 对象
             // image.src = imgUrl;
             image.src = e.target.result;
             image.onload = function(){
             document.body.appendChild(image);
             }
*/
            var image = new Image();
            // 设置src属性
            image.src = e.target.result;
            var max=200;
            // 绑定load事件处理器，加载完成后执行，避免同步问题
            image.onload = function(){
                // 获取 canvas DOM 对象
                var canvas = document.getElementById(id + "Cvs");
                // 如果高度超标 宽度等比例缩放 *=
                /*if(image.height > max) {
                 image.width *= max / image.height;
                 image.height = max;
                 } */
                // 获取 canvas的 2d 环境对象,
                var ctx = canvas.getContext("2d");
                // canvas清屏
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                // 重置canvas宽高
                /*canvas.width = image.width;
                 canvas.height = image.height;
                 if (canvas.width>max) {canvas.width = max;}*/
                // 将图像绘制到canvas上
                // ctx.drawImage(image, 0, 0, image.width, image.height);
                ctx.drawImage(image, 0, 0, 200, 200);
                // 注意，此时image没有加入到dom之中
            };
        }
    };

    var xhr = function(){
        if (window.XMLHttpRequest) {
            return new XMLHttpRequest();
        }else{
            return new ActiveObject('Micrsorf.XMLHttp');
        }
    }();
    console.log(xhr.readyState);

    function uploadPic(id, data){
        lockScreen();
        var formdata = new FormData();
        formdata.append("photoFile", data);
//        alert(data)

        xhr.onreadystatechange = function(){
            switch(xhr.readyState){
                case 0 :
                    console.log(0,'未初始化....');
                    break;
                case 1 :
                    console.log(1,'请求参数已准备，尚未发送请求...');
                    break;
                case 2 :
                    console.log(2,'正在添加....');
                    break;
                case 3 :
                    console.log(3,'已接收数据长度：'+xhr.responseText.length );
                    break;
                case 4 :
                    console.log(4,'响应全部接受完毕');
                    if ((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304) {
                        var ret = JSON.parse(xhr.response)

                        if(location.href.indexOf('thinkcmf') > 0){ //未部署在根目录
                            $("input[name='" + id + "']").val("/thinkcmf/Public" + ret.savepath + ret.savename);
                        }
                        else{
                            $("input[name='" + id + "']").val("/Public" + ret.savepath + ret.savename);
                        }
                    }else{
                        alert('error: 上传失败, 请重试!') ;
                    }
                    setTimeout('cancelScreen()',500);

                    break;
            }
        }
        xhr.open('post','__URL__/upload?functionName=register');
//        xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded')
        xhr.send(formdata);

    };

    function cancelScreen(){
        $(".loader").css('display','none')
    }

    function lockScreen(){
        $(".loader").css('display','')

    }
    function encodeFormData(data){
        if(!data) return '';
        var pairs = [];
        for(var name in data){
            if(!data.hasOwnProperty(name)) continue;
            if(typeof data[name] === 'function') continue;
            var value = data[name].toString();
            name = encodeURIComponent(name.replace('%20','+'));
            value = encodeURIComponent(value.replace('%20','+'));
            pairs.push(name+'='+value);
        }
        return pairs.join('&');
    }

    $(function () {
        $("#address").citySelect({
            nodata: "none",
            required: false
        });

    });

    $(function () {
        $('#doc-form-file').on('change', function () {
            var fileNames = '';
            $.each(this.files, function () {
                fileNames += '<span class="am-badge">' + this.name + '</span> ';
            });
            $('#file-list').html(fileNames);
        });
    });
</script>
<script src="{$JS_URL}amazeui.datetimepicker.js"></script>

<script>
    $('#datetimepicker')
            .datetimepicker()
            .on('changeDate', function (ev) {
                alert(ev.date)
            });

    function reg() {
        jQuery("#apply1").css("display","none")
        jQuery("#apply2").css("display","");

        var tourl = $("#register").attr("action");
        var application = $("#register").serialize();

                $.post("__URL__/register?functionName=register", application,function(data,textStatus){
                    if(data.state == "fail"){
                        alert(data.info)
                    }
                    else{
                        location.href = data.url;
                    }
                });
    }

</script>

</body>
</html>